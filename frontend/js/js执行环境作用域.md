## JS执行环境及作用域：

### 执行环境
JS代码大部分情况下编译发生在代码执行前的几微秒（甚至更短时间内），即任何JS代码片段在执行前都要进行编译

变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量，然后在运行时引擎会在作用域中查找该变量，如果能找到就会对其进行赋值

每当函数（代码）被调用的时候，就会产生一个新的执行环境和相应的作用域链，它是运行中的函数的意思，或者说执行环境是一个概念，一种机制，用来完成JavaScript运行时在作用域、生存期等方面的处理。

执行环境分为：

	全局执行环境，函数执行环境，eval执行环境。
作用域： 就是变量与函数可访问的范围，作用域控制变量与函数的可见性和生命周期，分为全局作用域和函数作用域。 作用域负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套规则，确定当前执行的代码对这些标识符的访问权限。


执行环境定义了变量， 定义了函数有权访问的其他数据，决定各自行为；每一个执行环境都有个与之相关的变量对象 VO,在这个环境中定义的所有变量和函数都保存在这个对象中，只有解析器在处理数据时候会在后台使用它。


最外围的执行环境是全局执行环境，根据在浏览器端还是node端，表示执行环境的对象也不一样，window，global。全局变量和函数都是作为其属性和方法创建的。
每个函数都有自己的执行环境，当执行流进入一个函数时候，函数的环境会被推入一个栈中，执行完便出栈，把控制权返回给之前的执行环境。
### 作用域链
当代码在一个环境中执行的时候，会创建变量对象的一个作用域链（作用域就是变量与函数的可访问范围）。其主要用途是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的最前端是当前执行代码所在环境的变量对象。如果这个环境是函数，则将函数的活动对象AO作为变量对象，AO在最开始只包含一个arguments变量，作用域连的下一个变量对象来自于包含环境。

	标识符解析是沿着作用域链一级一级得搜索标识符的过程，搜索过程始终从作用域链的前端开始
	
例如在创建一个comps()函数时候，会创建一个预先包含全局变量对象的作用域链，这个作用域链被保存在内部的   [[scope]]属性中，当调用comps函数时，会为函数创建一个执行环境（执行上下文 execution context) 的内部对象，都会有自己的作用域链），然后通过复制[[scope]]属性中的对象构建执行环境的作用域链，此时又有一个活动对象AO（作为变量对象使用，包含函数所有局部变量、命名参数、参数集合以及this）被创建并被推入执行环境作用域链的前端。作用域链的本质就是一个指向变量对象的指针列表，它只引用但并不实际包含变量对象。在一个函数中定义的另一个函数会将包含函数的活动对象添加到他的作用域链中。而 this 是在运行时基于函数的执行环境绑定的，每个函数在被调用的时候都会自动取得this和arguments 两个特殊的变量。
